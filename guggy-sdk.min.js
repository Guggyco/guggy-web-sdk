var Guggy=function(){var reqwest=function(e,t,s){return s()}("reqwest",this,function(){function succeed(e){var t=protocolRe.exec(e.url)
return t=t&&t[1]||context.location.protocol,httpsRe.test(t)?twoHundo.test(e.request.status):!!e.request.response}function handleReadyState(e,t,s){return function(){return e._aborted?s(e.request):e._timedOut?s(e.request,"Request is aborted: timeout"):void(e.request&&4==e.request[readyState]&&(e.request.onreadystatechange=noop,succeed(e)?t(e.request):s(e.request)))}}function setHeaders(e,t){var s,r=t.headers||{}
r.Accept=r.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"]
var n="undefined"!=typeof FormData&&t.data instanceof FormData
!t.crossOrigin&&!r[requestedWith]&&(r[requestedWith]=defaultHeaders.requestedWith),!r[contentType]&&!n&&(r[contentType]=t.contentType||defaultHeaders.contentType)
for(s in r)r.hasOwnProperty(s)&&"setRequestHeader"in e&&e.setRequestHeader(s,r[s])}function setCredentials(e,t){"undefined"!=typeof t.withCredentials&&"undefined"!=typeof e.withCredentials&&(e.withCredentials=!!t.withCredentials)}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,s,r){var n=uniqid++,i=e.jsonpCallback||"callback",a=e.jsonpCallbackName||reqwest.getcallbackPrefix(n),o=new RegExp("((^|\\?|&)"+i+")=([^&]+)"),l=r.match(o),u=doc.createElement("script"),c=0,p=navigator.userAgent.indexOf("MSIE 10.0")!==-1
return l?"?"===l[3]?r=r.replace(o,"$1="+a):a=l[3]:r=urlappend(r,i+"="+a),context[a]=generalCallback,u.type="text/javascript",u.src=r,u.async=!0,"undefined"!=typeof u.onreadystatechange&&!p&&(u.htmlFor=u.id="_reqwest_"+n),u.onload=u.onreadystatechange=function(){return!(u[readyState]&&"complete"!==u[readyState]&&"loaded"!==u[readyState]||c)&&(u.onload=u.onreadystatechange=null,u.onclick&&u.onclick(),t(lastValue),lastValue=void 0,head.removeChild(u),c=1,void 0)},head.appendChild(u),{abort:function(){u.onload=u.onreadystatechange=null,s({},"Request is aborted: timeout",{}),lastValue=void 0,head.removeChild(u),c=1}}}function getRequest(e,t){var s,r=this.o,n=(r.method||"GET").toUpperCase(),i="string"==typeof r?r:r.url,a=r.processData!==!1&&r.data&&"string"!=typeof r.data?reqwest.toQueryString(r.data):r.data||null,o=!1
return("jsonp"==r.type||"GET"==n)&&a&&(i=urlappend(i,a),a=null),"jsonp"==r.type?handleJsonp(r,e,t,i):(s=r.xhr&&r.xhr(r)||xhr(r),s.open(n,i,r.async!==!1),setHeaders(s,r),setCredentials(s,r),context[xDomainRequest]&&s instanceof context[xDomainRequest]?(s.onload=e,s.onerror=t,s.onprogress=function(){},o=!0):s.onreadystatechange=handleReadyState(this,e,t),r.before&&r.before(s),o?setTimeout(function(){s.send(a)},200):s.send(a),s)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){if(null!==e)return e.match("json")?"json":e.match("javascript")?"js":e.match("text")?"html":e.match("xml")?"xml":void 0}function init(o,fn){function complete(e){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(e)}function success(resp){var type=o.type||resp&&setType(resp.getResponseHeader("Content-Type"))
resp="jsonp"!==type?self.request:resp
var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse
try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=context.JSON?context.JSON.parse(r):eval("("+r+")")}catch(e){return error(resp,"Could not parse JSON in response",e)}break
case"js":resp=eval(r)
break
case"html":resp=r
break
case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);self._fulfillmentHandlers.length>0;)resp=self._fulfillmentHandlers.shift()(resp)
complete(resp)}function timedOut(){self._timedOut=!0,self.request.abort()}function error(e,t,s){for(e=self.request,self._responseArgs.resp=e,self._responseArgs.msg=t,self._responseArgs.t=s,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(e,t,s)
complete(e)}this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={}
var self=this
fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){timedOut()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var s,r,n,i,a=e.name,o=e.tagName.toLowerCase(),l=function(e){e&&!e.disabled&&t(a,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))}
if(!e.disabled&&a)switch(o){case"input":/reset|button|image|file/i.test(e.type)||(s=/checkbox/i.test(e.type),r=/radio/i.test(e.type),n=e.value,(!s&&!r||e.checked)&&t(a,normalize(s&&""===n?"on":n)))
break
case"textarea":t(a,normalize(e.value))
break
case"select":if("select-one"===e.type.toLowerCase())l(e.selectedIndex>=0?e.options[e.selectedIndex]:null)
else for(i=0;e.length&&i<e.length;i++)e.options[i].selected&&l(e.options[i])}}function eachFormElement(){var e,t,s=this,r=function(e,t){var r,n,i
for(r=0;r<t.length;r++)for(i=e[byTag](t[r]),n=0;n<i.length;n++)serial(i[n],s)}
for(t=0;t<arguments.length;t++)e=arguments[t],/input|select|textarea/i.test(e.tagName)&&serial(e,s),r(e,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={}
return eachFormElement.apply(function(t,s){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(s)):e[t]=s},arguments),e}function buildParams(e,t,s,r){var n,i,a,o=/\[\]$/
if(isArray(t))for(i=0;t&&i<t.length;i++)a=t[i],s||o.test(e)?r(e,a):buildParams(e+"["+("object"==typeof a?i:"")+"]",a,s,r)
else if(t&&"[object Object]"===t.toString())for(n in t)buildParams(e+"["+n+"]",t[n],s,r)
else r(e,t)}var context=this
if("window"in context)var doc=document,byTag="getElementsByTagName",head=doc[byTag]("head")[0]
else{var XHR2
try{XHR2=require("xhr2")}catch(e){throw new Error("Peer dependency `xhr2` required! Please npm install xhr2")}}var httpsRe=/^http/,protocolRe=/(^\w+):\/\//,twoHundo=/^(20\d|1223)$/,readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray="function"==typeof Array.isArray?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(e){if(e.crossOrigin===!0){var t=context[xmlHttpRequest]?new XMLHttpRequest:null
if(t&&"withCredentials"in t)return t
if(context[xDomainRequest])return new XDomainRequest
throw new Error("Browser does not support cross-origin requests")}return context[xmlHttpRequest]?new XMLHttpRequest:XHR2?new XHR2:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(e){return e}}
return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){return e=e||function(){},t=t||function(){},this._fulfilled?this._responseArgs.resp=e(this._responseArgs.resp):this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(e),this._errorHandlers.push(t)),this},always:function(e){return this._fulfilled||this._erred?e(this._responseArgs.resp):this._completeHandlers.push(e),this},fail:function(e){return this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(e),this},catch:function(e){return this.fail(e)}},reqwest.serializeArray=function(){var e=[]
return eachFormElement.apply(function(t,s){e.push({name:t,value:s})},arguments),e},reqwest.serialize=function(){if(0===arguments.length)return""
var e,t,s=Array.prototype.slice.call(arguments,0)
return e=s.pop(),e&&e.nodeType&&s.push(e)&&(e=null),e&&(e=e.type),t="map"==e?serializeHash:"array"==e?reqwest.serializeArray:serializeQueryString,t.apply(null,s)},reqwest.toQueryString=function(e,t){var s,r,n=t||!1,i=[],a=encodeURIComponent,o=function(e,t){t="function"==typeof t?t():null==t?"":t,i[i.length]=a(e)+"="+a(t)}
if(isArray(e))for(r=0;e&&r<e.length;r++)o(e[r].name,e[r].value)
else for(s in e)e.hasOwnProperty(s)&&buildParams(s,e[s],n,o)
return i.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest.ajaxSetup=function(e){e=e||{}
for(var t in e)globalSetupOptions[t]=e[t]},reqwest}),SERVER="https://text2gif.guggy.com",TEXT2GIF_URL=SERVER+"/guggify",EXTRACT_MEDIA_URL=SERVER+"/extractMedia",RANDOM_GIF_URL=SERVER+"/randomGIF",Utils={extendObject:function(e,t){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])},post:function(e,t,s,r){reqwest({url:e,data:JSON.stringify(t),type:"json",method:"post",headers:s,error:function(e){r(null,e)},success:r})},debounce:function(e,t,s){var r,n,i=function(e,t){return t=null==t?e.length-1:+t,function(){for(var s=Math.max(arguments.length-t,0),r=Array(s),n=0;n<s;n++)r[n]=arguments[n+t]
switch(t){case 0:return e.call(this,r)
case 1:return e.call(this,arguments[0],r)
case 2:return e.call(this,arguments[0],arguments[1],r)}var i=Array(t+1)
for(n=0;n<t;n++)i[n]=arguments[n]
return i[t]=r,e.apply(this,i)}},a=i(function(e,t,s){return setTimeout(function(){return e.apply(null,s)},t)}),o=function(t,s){r=null,s&&(n=e.apply(t,s))},l=i(function(i){if(r&&clearTimeout(r),s){var l=!r
r=setTimeout(o,t),l&&(n=e.apply(this,i))}else r=a(o,t,this,i)
return n})
return l.cancel=function(){clearTimeout(r),r=null},l.isQueueEmpty=function(){return null==r},l}},Guggy={VERSION:"1.4.0",init:function(e){this.apiKey=e.apiKey,this.onStart=e.onStart,this.width=e.width,this._onTypeDebounced=Utils.debounce(this._onType,200),this.lastText="",this.isInitialized=!0,e.userId&&(this.userId=e.apiKey+"_"+e.userId)},_extractMedia:function(e,t){Guggy.isInitialized?Utils.post(EXTRACT_MEDIA_URL,{sentence:e,noTranslation:!0},{"Content-Type":"application/json",apiKey:this.apiKey},function(e,s){s?t(null,s):t(e)}.bind(this)):(console.error("Guggy was not initialized"),t(null,"Guggy was not initialized"))},_onType:function(e,t){(!this.extractMediaResult||e.trim()!=this.extractMediaResult.lastString)&&e.trim().length>0?(this.extractMediaResult||(this.extractMediaResult={}),this.extractMediaResult.lastString=e.trim(),this.isExtractInProgress=!0,this._extractMedia(e,function(e,s){if(this.isExtractInProgress=!1,e){var r=e.media[0]
this.extractMediaResult.lastHash!=e.hash?(this.extractMediaResult.lastHash=e.hash,this.extractMediaResult.request={reqId:e.reqId,predefinedSource:null},e.isNonEnglish||(this.extractMediaResult.request.predefinedSource={canvasDimensions:{width:r.dimensions.width,height:r.dimensions.height},url:r.url,isStillImage:!1}),t(r)):t()}else t()}.bind(this))):t()},onType:function(e,t){e?this.lastText.length<e.length&&/[^\s][\s]$/.test(e)?(this._onTypeDebounced.cancel(),this._onType(e,t)):this._onTypeDebounced(e,t):t()},createGug:function(e,t){if(Guggy.isInitialized)if(e&&0!=e.trim().length){this.onStart&&this.onStart()
var s,r={format:"gif",userId:this.userId,platform:"js"}
this.width&&(r.width=this.width),this.extractMediaResult&&!this.isExtractInProgress&&this._onTypeDebounced.isQueueEmpty()?(s=this.extractMediaResult.request,Utils.extendObject(r,s)):s=r,s.sentence=e,Utils.post(TEXT2GIF_URL,s,{"Content-Type":"application/json",apiKey:this.apiKey},function(e,s){this.extractMediaResult=null,s?t(null,s):t(e)}.bind(this))}else t(null,"Empty Sentence")
else console.error("Guggy was not initialized"),t(null,"Guggy was not initialized")},getRandomGIF:function(e){Utils.post(RANDOM_GIF_URL,{},{"Content-Type":"application/json",apiKey:this.apiKey},function(t,s){s?e(null,s):e(t)}.bind(this))}}
return Guggy}()
"window"in this?window.Guggy=Guggy:"undefined"!=typeof module&&module.exports&&(module.exports=Guggy)
