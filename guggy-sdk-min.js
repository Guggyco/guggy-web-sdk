!function(){!function(a,b,c){"undefined"!=typeof module&&module.exports?module.exports=c():"function"==typeof define&&define.amd?define(c):b[a]=c()}("reqwest",this,function(){function succeed(a){var b=protocolRe.exec(a.url);return b=b&&b[1]||context.location.protocol,httpsRe.test(b)?twoHundo.test(a.request.status):!!a.request.response}function handleReadyState(a,b,c){return function(){return a._aborted?c(a.request):a._timedOut?c(a.request,"Request is aborted: timeout"):void(a.request&&4==a.request[readyState]&&(a.request.onreadystatechange=noop,succeed(a)?b(a.request):c(a.request)))}}function setHeaders(a,b){var d,c=b.headers||{};c.Accept=c.Accept||defaultHeaders.accept[b.type]||defaultHeaders.accept["*"];var e="undefined"!=typeof FormData&&b.data instanceof FormData;!b.crossOrigin&&!c[requestedWith]&&(c[requestedWith]=defaultHeaders.requestedWith),!c[contentType]&&!e&&(c[contentType]=b.contentType||defaultHeaders.contentType);for(d in c)c.hasOwnProperty(d)&&"setRequestHeader"in a&&a.setRequestHeader(d,c[d])}function setCredentials(a,b){"undefined"!=typeof b.withCredentials&&"undefined"!=typeof a.withCredentials&&(a.withCredentials=!!b.withCredentials)}function generalCallback(a){lastValue=a}function urlappend(a,b){return a+(/\?/.test(a)?"&":"?")+b}function handleJsonp(a,b,c,d){var e=uniqid++,f=a.jsonpCallback||"callback",g=a.jsonpCallbackName||reqwest.getcallbackPrefix(e),h=new RegExp("((^|\\?|&)"+f+")=([^&]+)"),i=d.match(h),j=doc.createElement("script"),k=0,l=navigator.userAgent.indexOf("MSIE 10.0")!==-1;return i?"?"===i[3]?d=d.replace(h,"$1="+g):g=i[3]:d=urlappend(d,f+"="+g),context[g]=generalCallback,j.type="text/javascript",j.src=d,j.async=!0,"undefined"!=typeof j.onreadystatechange&&!l&&(j.htmlFor=j.id="_reqwest_"+e),j.onload=j.onreadystatechange=function(){return!(j[readyState]&&"complete"!==j[readyState]&&"loaded"!==j[readyState]||k)&&(j.onload=j.onreadystatechange=null,j.onclick&&j.onclick(),b(lastValue),lastValue=void 0,head.removeChild(j),k=1,void 0)},head.appendChild(j),{abort:function(){j.onload=j.onreadystatechange=null,c({},"Request is aborted: timeout",{}),lastValue=void 0,head.removeChild(j),k=1}}}function getRequest(a,b){var g,c=this.o,d=(c.method||"GET").toUpperCase(),e="string"==typeof c?c:c.url,f=c.processData!==!1&&c.data&&"string"!=typeof c.data?reqwest.toQueryString(c.data):c.data||null,h=!1;return("jsonp"==c.type||"GET"==d)&&f&&(e=urlappend(e,f),f=null),"jsonp"==c.type?handleJsonp(c,a,b,e):(g=c.xhr&&c.xhr(c)||xhr(c),g.open(d,e,c.async!==!1),setHeaders(g,c),setCredentials(g,c),context[xDomainRequest]&&g instanceof context[xDomainRequest]?(g.onload=a,g.onerror=b,g.onprogress=function(){},h=!0):g.onreadystatechange=handleReadyState(this,a,b),c.before&&c.before(g),h?setTimeout(function(){g.send(f)},200):g.send(f),g)}function Reqwest(a,b){this.o=a,this.fn=b,init.apply(this,arguments)}function setType(a){if(null!==a)return a.match("json")?"json":a.match("javascript")?"js":a.match("text")?"html":a.match("xml")?"xml":void 0}function init(o,fn){function complete(a){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(a)}function success(resp){var type=o.type||resp&&setType(resp.getResponseHeader("Content-Type"));resp="jsonp"!==type?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(a){}if(r)switch(type){case"json":try{resp=context.JSON?context.JSON.parse(r):eval("("+r+")")}catch(a){return error(resp,"Could not parse JSON in response",a)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);self._fulfillmentHandlers.length>0;)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function timedOut(){self._timedOut=!0,self.request.abort()}function error(a,b,c){for(a=self.request,self._responseArgs.resp=a,self._responseArgs.msg=b,self._responseArgs.t=c,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(a,b,c);complete(a)}this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){timedOut()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(a,b){return new Reqwest(a,b)}function normalize(a){return a?a.replace(/\r?\n/g,"\r\n"):""}function serial(a,b){var f,g,h,i,c=a.name,d=a.tagName.toLowerCase(),e=function(a){a&&!a.disabled&&b(c,normalize(a.attributes.value&&a.attributes.value.specified?a.value:a.text))};if(!a.disabled&&c)switch(d){case"input":/reset|button|image|file/i.test(a.type)||(f=/checkbox/i.test(a.type),g=/radio/i.test(a.type),h=a.value,(!f&&!g||a.checked)&&b(c,normalize(f&&""===h?"on":h)));break;case"textarea":b(c,normalize(a.value));break;case"select":if("select-one"===a.type.toLowerCase())e(a.selectedIndex>=0?a.options[a.selectedIndex]:null);else for(i=0;a.length&&i<a.length;i++)a.options[i].selected&&e(a.options[i])}}function eachFormElement(){var b,c,a=this,d=function(b,c){var d,e,f;for(d=0;d<c.length;d++)for(f=b[byTag](c[d]),e=0;e<f.length;e++)serial(f[e],a)};for(c=0;c<arguments.length;c++)b=arguments[c],/input|select|textarea/i.test(b.tagName)&&serial(b,a),d(b,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var a={};return eachFormElement.apply(function(b,c){b in a?(a[b]&&!isArray(a[b])&&(a[b]=[a[b]]),a[b].push(c)):a[b]=c},arguments),a}function buildParams(a,b,c,d){var e,f,g,h=/\[\]$/;if(isArray(b))for(f=0;b&&f<b.length;f++)g=b[f],c||h.test(a)?d(a,g):buildParams(a+"["+("object"==typeof g?f:"")+"]",g,c,d);else if(b&&"[object Object]"===b.toString())for(e in b)buildParams(a+"["+e+"]",b[e],c,d);else d(a,b)}var context=this;if("window"in context)var doc=document,byTag="getElementsByTagName",head=doc[byTag]("head")[0];else{var XHR2;try{XHR2=require("xhr2")}catch(a){throw new Error("Peer dependency `xhr2` required! Please npm install xhr2")}}var httpsRe=/^http/,protocolRe=/(^\w+):\/\//,twoHundo=/^(20\d|1223)$/,readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray="function"==typeof Array.isArray?Array.isArray:function(a){return a instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(a){if(a.crossOrigin===!0){var b=context[xmlHttpRequest]?new XMLHttpRequest:null;if(b&&"withCredentials"in b)return b;if(context[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return context[xmlHttpRequest]?new XMLHttpRequest:XHR2?new XHR2:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(a){return a}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(a,b){return a=a||function(){},b=b||function(){},this._fulfilled?this._responseArgs.resp=a(this._responseArgs.resp):this._erred?b(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(a),this._errorHandlers.push(b)),this},always:function(a){return this._fulfilled||this._erred?a(this._responseArgs.resp):this._completeHandlers.push(a),this},fail:function(a){return this._erred?a(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(a),this},catch:function(a){return this.fail(a)}},reqwest.serializeArray=function(){var a=[];return eachFormElement.apply(function(b,c){a.push({name:b,value:c})},arguments),a},reqwest.serialize=function(){if(0===arguments.length)return"";var a,b,c=Array.prototype.slice.call(arguments,0);return a=c.pop(),a&&a.nodeType&&c.push(a)&&(a=null),a&&(a=a.type),b="map"==a?serializeHash:"array"==a?reqwest.serializeArray:serializeQueryString,b.apply(null,c)},reqwest.toQueryString=function(a,b){var c,d,e=b||!1,f=[],g=encodeURIComponent,h=function(a,b){b="function"==typeof b?b():null==b?"":b,f[f.length]=g(a)+"="+g(b)};if(isArray(a))for(d=0;a&&d<a.length;d++)h(a[d].name,a[d].value);else for(c in a)a.hasOwnProperty(c)&&buildParams(c,a[c],e,h);return f.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(a,b){return a&&(a.type&&(a.method=a.type)&&delete a.type,a.dataType&&(a.type=a.dataType),a.jsonpCallback&&(a.jsonpCallbackName=a.jsonpCallback)&&delete a.jsonpCallback,a.jsonp&&(a.jsonpCallback=a.jsonp)),new Reqwest(a,b)},reqwest.ajaxSetup=function(a){a=a||{};for(var b in a)globalSetupOptions[b]=a[b]},reqwest});var TEXT2GIF_URL="https://guggy-gif2text-server.herokuapp.com/guggify",EXTRACT_MEDIA_URL="https://guggy-gif2text-server.herokuapp.com/extractMedia",Utils={post:function(a,b,c,d){reqwest({url:a,data:JSON.stringify(b),type:"json",method:"post",headers:c,error:function(a){d(null,a)},success:d})},debounce:function(a,b,c){var f,g,d=function(a,b){return b=null==b?a.length-1:+b,function(){for(var c=Math.max(arguments.length-b,0),d=Array(c),e=0;e<c;e++)d[e]=arguments[e+b];switch(b){case 0:return a.call(this,d);case 1:return a.call(this,arguments[0],d);case 2:return a.call(this,arguments[0],arguments[1],d)}var f=Array(b+1);for(e=0;e<b;e++)f[e]=arguments[e];return f[b]=d,a.apply(this,f)}},e=d(function(a,b,c){return setTimeout(function(){return a.apply(null,c)},b)}),h=function(b,c){f=null,c&&(g=a.apply(b,c))},i=d(function(d){if(f&&clearTimeout(f),c){var i=!f;f=setTimeout(h,b),i&&(g=a.apply(this,d))}else f=e(h,b,this,d);return g});return i.cancel=function(){clearTimeout(f),f=null},i}},Guggy={VERSION:1.2,init:function(a){this.apiKey=a.apiKey,this.onStart=a.onStart,this.onType=Utils.debounce(this._onType,200),this.isInitialized=!0},_extractMedia:function(a,b){Guggy.isInitialized?Utils.post(EXTRACT_MEDIA_URL,{sentence:a,noTranslation:!0},{"Content-Type":"application/json",apiKey:this.apiKey},function(a,c){c?b(null,c):b(a)}.bind(this)):(console.error("Guggy was not initialized"),b(null,"Guggy was not initialized"))},_onType:function(a,b){(!this.extractMediaResult||a.trim()!=this.extractMediaResult.lastString)&&a.trim().length>0&&(this.extractMediaResult={},this.extractMediaResult.lastString=a.trim(),this._extractMedia(a,function(a,c){if(a){var d=a.media[0];this.extractMediaResult.lastHash!=a.hash?(this.extractMediaResult.lastHash=a.hash,this.extractMediaResult.request={reqId:a.reqId,predefinedSource:null,format:"gif"},a.isNonEnglish||(this.extractMediaResult.request.predefinedSource={canvasDimensions:{width:d.dimensions.width,height:d.dimensions.height},url:d.url,isStillImage:!1}),b(d)):b()}else b()}.bind(this)))},createGug:function(a,b){if(Guggy.isInitialized)if(a&&0!=a.trim().length){this.onStart&&this.onStart();var c;c=this.extractMediaResult?this.extractMediaResult.request:{format:"gif"},c.sentence=a,Utils.post(TEXT2GIF_URL,c,{"Content-Type":"application/json",apiKey:this.apiKey},function(a,c){this.extractMediaResult=null,c?b(null,c):(this.lastResult=a,b(a))}.bind(this))}else b(null,"Empty Sentence");else console.error("Guggy was not initialized"),b(null,"Guggy was not initialized")}};window.Guggy=Guggy}();